--- snakefiles/align_bwa.smk.orig	2025-10-21 11:28:26.000000000 -0400
+++ snakefiles/align_bwa.smk	2025-10-21 14:06:40.000000000 -0400
@@ -45,8 +45,8 @@
         f"{workflow_geno}.preprocess.log"
     params:
         genome_zip
-    conda:
-        "envs/align.yaml"
+    envmodules:
+        "seqtk/1.4", "bwa-mem2/2.2.1", "samtools/1.22.1"
     shell: 
         """
         {{
@@ -101,8 +101,8 @@
         extra = extra
     threads:
         min(6, workflow.cores - 1)
-    conda:
-        "envs/align.yaml"
+    envmodules:
+            "bwa-mem2/2.2.1", "samtools/1.22.1"
     shell:
         """
         {{
@@ -140,6 +140,8 @@
         mem_mb = 2000
     container:
         None
+    envmodules:
+        "samtools/1.22.1"
     threads:
         4
     shell:
@@ -159,6 +161,7 @@
         rm -rf {params.tmpdir}
         """
 
+
 rule assign_molecules:
     priority: 100
     input:
@@ -172,6 +175,8 @@
         molecule_distance
     container:
         None
+    envmodules:
+        "samtools/1.22.1"
     shell:
         """
         assign_mi -c {params} {input} > {output.bam} 2> {log}
@@ -217,6 +222,8 @@
         "reports/data/coverage/{sample}.cov.gz"
     container:
         None
+    envmodules:
+        "samtools/1.22.1"
     shell:
         "samtools bedcov -c {input.bed} {input.bam} | awk '{{ $6 = ($4 / ($3 + 1 - $2)); print }}' | gzip > {output}"
 
@@ -250,8 +257,8 @@
         samplename = lambda wc: "-P sample:" + wc.get("sample")
     log:
         "logs/reports/{sample}.alignstats.log"
-    conda:
-        "envs/report.yaml"
+    envmodules:        
+        "r/4.5.0", "arrow/21.0.0"
     retries:
         3
     shell:
@@ -270,8 +277,6 @@
         output:
             "{sample}.bam.bai",
             bam = "{sample}.bam"
-        container:
-            None
         shell:
             """
             mv {input} {output.bam}
@@ -289,6 +294,8 @@
         "logs/stats/{sample}.samstats.log"
     container:
         None
+    envmodules:
+        "samtools/1.22.1"
     shell:
         """
         {{
@@ -309,8 +316,8 @@
         title = "--title \"Basic Alignment Statistics\"",
         comment = "--comment \"This report aggregates samtools stats and samtools flagstats results for all alignments. Samtools stats ignores alignments marked as duplicates.\"",
         outdir = "reports/data/samtools_stats reports/data/samtools_flagstat"
-    conda:
-        "envs/qc.yaml"
+    envmodules:
+            "arrow/21.0.0"
     shell:
         "multiqc {params} > {output} 2> {log}"
 
@@ -327,8 +334,8 @@
         f"reports/data/bxstats/"
     log:
         f"logs/reports/bxstats.report.log"
-    conda:
-        "envs/report.yaml"
+    envmodules: 
+        "r/4.5.0"
     retries:
         3
     shell:
