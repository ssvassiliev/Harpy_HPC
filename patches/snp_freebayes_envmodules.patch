--- snakefiles/snp_freebayes.smk.orig	2025-10-21 19:33:51.000000000 -0700
+++ snakefiles/snp_freebayes.smk	2025-10-21 19:24:05.000000000 -0700
@@ -58,6 +58,8 @@
         f"{workflow_geno}.preprocess.log"
     container:
         None
+    envmodules:
+        "seqtk/1.4", "samtools/1.22.1"
     shell: 
         """
         {{
@@ -73,6 +75,8 @@
         "{bam}.bai"
     container:
         None
+    envmodules:
+        "samtools/1.22.1"
     shell:
         "samtools index {input}"
 
@@ -106,8 +110,8 @@
         static = "--strict-vcf",
         populations = "--populations workflow/sample.groups" if groupings else "",
         extra = extra
-    conda:
-        "envs/variants.yaml"
+    envmodules:
+        "freebayes/1.3.7", "bcftools/1.22"
     shell:
         """
         freebayes -f {input.reference} -L {input.bamlist} {params} 2> {log} |
@@ -136,6 +140,8 @@
         workflow.cores
     container:
         None
+    envmodules:
+        "bcftools/1.22"
     shell:  
         "bcftools concat -f {input.filelist} --threads {threads} --naive -Ob -o {output} 2> {log}"
 
@@ -147,6 +153,8 @@
         csi = "variants.raw.bcf.csi"
     container:
         None
+    envmodules:
+        "bcftools/1.22"
     shell:
         "bcftools sort --write-index -Ob -o {output.bcf} {input} 2> /dev/null"
 
@@ -168,6 +176,8 @@
         workflow.cores
     container:
         None
+    envmodules:
+        "bcftools/1.22"
     shell:
         "bcftools norm --threads {threads} {params} -o {output.bcf} -f {input.genome} {input.bcf} 2> {log}"    
 
@@ -181,6 +191,8 @@
         "reports/data/variants.{type}.stats",
     container:
         None
+    envmodules:
+        "bcftools/1.22"
     shell:
         """
         bcftools stats -s "-" --fasta-ref {input.genome} {input.bcf} > {output} 2> /dev/null
@@ -211,8 +223,8 @@
         lambda wc: "-P vcf:variants." + wc.get("type")
     log:
         "logs/variants.{type}.report.log"
-    conda:
-        "envs/report.yaml"
+    envmodules:
+        "r/4.5.0", "arrow/21.0.0"
     retries:
         3
     shell:
